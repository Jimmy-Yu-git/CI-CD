{"code":"(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{120:function(e,n,t){},166:function(e,n,t){},249:function(e,n,t){\"use strict\";t.r(n);var a,c,s,o,r,i=t(0),l=t.n(i),b=t(28),u=t.n(b),j=(t(165),t(166),t(33)),m=(t(120),t(266)),d=t(273),g=t(14),O=function(e){var n=e.me,t=e.setMe,a=e.setSignIn,c=e.displayStatus;return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(\"div\",{className:\"App-title\",children:Object(g.jsx)(\"h1\",{children:\"My Chat Room\"})}),Object(g.jsx)(m.a.Search,{prefix:Object(g.jsx)(d.a,{}),value:n,enterButton:\"Sign In\",onChange:function(e){return t(e.target.value)},placeholder:\"Enter your name\",size:\"large\",style:{width:300,margin:50},onSearch:function(e){e?(c({type:\"success\",msg:\"success\"}),a(!0)):c({type:\"error\",msg:\"Missing user name\"})}})]})},h=t(128),f=t(129),y=t(262),p=t(269),x=function(e){var n=e.visible,t=e.onCreate,a=e.onCancel,c=y.a.useForm(),s=Object(j.a)(c,1)[0];return Object(g.jsx)(p.a,{visible:n,title:\"Create a new chat room\",okText:\"Create\",cancelText:\"Cancel\",onCancel:a,onOk:function(){s.validateFields().then((function(e){s.resetFields(),t(e)})).catch((function(e){window.alert(e)}))},children:Object(g.jsx)(y.a,{form:s,layout:\"vertical\",name:\"form_in_modal\",children:Object(g.jsx)(y.a.Item,{name:\"name\",label:\"Name\",rules:[{required:!0,message:\"Error: Please enter the name of the person to chat!\"}],children:Object(g.jsx)(m.a,{})})})})},v=t(271),S=t(270),k=t(263),C=t(44),$=t(264),w=Object($.a)(a||(a=Object(C.a)([\"\\nmutation\\n    createChatBox( $name1:String,$name2:String){\\n        createChatBox(name1:$name1,name2:$name2){\\n            _id\\n          name\\n          messages{\\n                body\\n                sender{\\n              name\\n            }\\n            }\\n        }\\n    }\\n\\n    \\n\"]))),E=Object($.a)(c||(c=Object(C.a)([\"\\nmutation\\n    createMessage( $key:String,$body:String,$me:String){\\n        createMessage(key:$key,body:$body,me:$me){\\n            body\\n            sender{\\n              name\\n            }\\n        }\\n    }\\n\\n    \\n\"]))),F=Object($.a)(s||(s=Object(C.a)([\"\\nquery\\n    chatbox( $name1:String,$name2:String){\\n        chatbox(name1:$name1,name2:$name2){\\n          name\\n          messages{\\n                body\\n                sender{\\n              name\\n            }\\n            }\\n        }\\n    }\\n\\n    \\n\"]))),M=(Object($.a)(o||(o=Object(C.a)([\"\\nsubscription \\n    message ($name1:String,$name2:String) {\\n        message (name1:$name1,name2:$name2){\\n            mutation\\n            data {\\n                body\\n                sender{\\n                  name\\n                }             \\n            }\\n\\n        }\\n     \\n    }\\n\\n\"]))),Object($.a)(r||(r=Object(C.a)([\"\\n  subscription {\\n    allmessage {\\n        mutation\\n        data {\\n            body\\n            sender{\\n              name\\n            }             \\n        }\\n    }\\n  }\\n\"])))),I=k.a.TabPane,A=function(e){var n=e.me,t=e.displayStatus,a=Object(i.useState)(\"\"),c=Object(j.a)(a,2),s=c[0],o=c[1],r=Object(i.useState)(\"\"),l=Object(j.a)(r,2),b=l[0],u=l[1],d=Object(i.useState)(!1),O=Object(j.a)(d,2),y=(O[0],O[1]),p=Object(i.useState)(\"\"),C=Object(j.a)(p,2),$=C[0],A=C[1],B=Object(i.useState)([]),N=Object(j.a)(B,2),P=N[0],T=N[1],L=Object(i.useState)(!1),_=Object(j.a)(L,2),q=_[0],D=_[1],J=Object(i.useState)(\"\"),R=Object(j.a)(J,2),z=R[0],G=R[1];console.log(z);var K,Q,H,U=Object(v.a)(w),V=Object(j.a)(U,1)[0],W=Object(v.a)(E),X=Object(j.a)(W,1)[0];Object(i.useEffect)((function(){console.log(\"active\"),console.log(z),z&&(console.log(z),K=z.split(\"_\"),console.log(K),K[0]===n?(Q=K[0],H=K[1]):(Q=K[1],H=K[0]),o(Q),u(H))}),[z]),console.log(b);var Y=Object(S.a)(F,{variables:{name1:s,name2:b}}),Z=(Y.loading,Y.error,Y.data),ee=Y.subscribeToMore;console.log(Z),\"undefined\"===typeof Z&&console.log(\"111\"),Object(i.useEffect)((function(){console.log(\"11\"),ee({document:M,updateQuery:function(e,n){var t=n.subscriptionData;console.log(\"11\");var a=t.data.allmessage.data;return Object(f.a)(Object(f.a)({},e),{},{chatbox:[].concat(Object(h.a)(e.chatbox.messages),[a])})}})}),[ee]);console.log(\"render\"),console.log(P);return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(\"div\",{className:\"App-title\",children:Object(g.jsxs)(\"h1\",{children:[n,\"'s Chat Room\"]})}),Object(g.jsxs)(\"div\",{className:\"App-messages\",children:[Object(g.jsx)(k.a,{type:\"editable-card\",activeKey:z,onChange:function(e){G(e),alert(e)},onEdit:function(e,n){\"add\"===n?D(!0):\"remove\"===n&&function(e,n){var t,a=n;P.forEach((function(n,a){n.key===e&&(t=a-1)}));var c=P.filter((function(n){return n.key!==e}));c.length?a===e&&(a=t>=0?c[t].key:c[0].key):a=\"\",T(c),G(a)}(e,z)},children:P.map((function(e){var t=e.friend,a=e.key;e.chatLog;return Object(g.jsx)(I,{tab:t,closable:!0,children:\"undefined\"===typeof Z||null===Z.chatbox?Object(g.jsx)(\"p\",{children:\"Loading...\"}):0===Z.chatbox.messages.length?Object(g.jsx)(\"p\",{children:\"NO MESSAGE..\"}):Z.chatbox.messages.map((function(e,t){var a=e.sender,c=e.body;return a[0].name!==n?Object(g.jsxs)(\"p\",{children:[a[0].name,\":\",c]}):Object(g.jsxs)(\"p\",{style:{textAlign:\"right\"},children:[c,\":\",a[0].name]})}))},a)}))}),Object(g.jsx)(x,{visible:q,onCreate:function(e){!function(e,n){V({variables:{name1:n,name2:e}}),o(n),u(e);var t=[n,e].sort().join(\"_\");if(console.log(t),P.some((function(e){return e.key===t})))throw new Error(e+\"'s chat box has already opened.\");var a=Object(h.a)(P);a.push({friend:e,key:t,chatLog:[]}),T(a),G(t),y(!0)}(e.name,n),D(!1)},onCancel:function(){D(!1)}})]}),Object(g.jsx)(m.a.Search,{value:$,onChange:function(e){return A(e.target.value)},enterButton:\"Send\",placeholder:\"Enter message here...\",onSearch:function(e){if(e){if(\"\"===z)return t({type:\"error\",msg:\"Please add a chatbox first.\"}),void A(\"\");var a;a={key:z,body:e,sender:n},console.log(a),X({variables:{key:a.key,body:a.body,me:a.sender}}),A(\"\")}else t({type:\"error\",msg:\"Please enter message.\"})}})]})},B=t(153),N=\"save-me\",P=function(){var e=Object(i.useState)(!1),n=Object(j.a)(e,2),t=n[0],a=n[1],c=localStorage.getItem(N),s=Object(i.useState)(c||\"\"),o=Object(j.a)(s,2),r=o[0],l=o[1],b=function(e){if(e.msg){var n=e.type,t={content:e.msg,duration:1};switch(n){case\"success\":B.b.success(t);break;case\"error\":default:B.b.error(t)}}};return Object(i.useEffect)((function(){t&&localStorage.setItem(N,r)}),[t]),Object(g.jsx)(\"div\",{className:\"App\",children:t?Object(g.jsx)(A,{me:r,displayStatus:b}):Object(g.jsx)(O,{setMe:l,me:r,setSignIn:a,displayStatus:b})})},T=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,274)).then((function(n){var t=n.getCLS,a=n.getFID,c=n.getFCP,s=n.getLCP,o=n.getTTFB;t(e),a(e),c(e),s(e),o(e)}))},L=t(267),_=t(265),q=t(268),D=t(261),J=t(110),R=t(150),z=t(65),G=new L.a({uri:\"http://localhost:5000/\"}),K=new R.a({uri:\"ws://localhost:5000/\",options:{reconnect:!0}}),Q=Object(J.b)((function(e){var n=e.query,t=Object(z.a)(n);return\"OperationDefinition\"===t.kind&&\"subscription\"===t.operation}),K,G),H=new _.a({link:Q,cache:(new q.a).restore({})});u.a.render(Object(g.jsx)(l.a.StrictMode,{children:Object(g.jsx)(D.a,{client:H,children:Object(g.jsx)(P,{})})}),document.getElementById(\"root\")),T()}},[[249,1,2]]]);","name":"static/js/main.1636323d.chunk.js","map":{"version":3,"sources":["static/js/main.1636323d.chunk.js"],"names":["this","push","module","exports","__webpack_require__","__webpack_exports__","r","_templateObject","Mutationmess_templateObject","query_templateObject","messagesubscribe_templateObject","allmesssub_templateObject","react","react_default","n","react_dom","react_dom_default","slicedToArray","input","UserOutlined","jsx_runtime","signin","_ref","me","setMe","setSignIn","displayStatus","Object","children","className","Search","prefix","value","enterButton","onChange","e","target","placeholder","size","style","width","margin","onSearch","name","type","msg","toConsumableArray","objectSpread2","es_form","modal","chatModels","visible","onCreate","onCancel","_Form$useForm","useForm","form","title","okText","cancelText","onOk","validateFields","then","values","resetFields","catch","window","alert","layout","Item","label","rules","required","message","useMutation","useQuery","tabs","taggedTemplateLiteral","lib","CREATE_CHATBOX_MUTATION","CREATE_MESSAGE_MUTATION","CHATBOX_QUERY","AllMessage_Sub","TabPane","chatroom","_useState","_useState2","name1","setName1","_useState3","_useState4","name2","setName2","_useState5","_useState6","setIspush","_useState7","_useState8","messageInput","setMessageInput","_useState9","_useState10","chatBoxes","setChatBoxes","_useState11","_useState12","modalVisible","setModalVisible","_useState13","_useState14","activeKey","setActiveKey","console","log","myname","first","second","_useMutation","addChat","_useMutation3","addMessage","split","_useQuery","variables","data","loading","error","subscribeToMore","document","updateQuery","prev","_ref2","subscriptionData","newMess","allmessage","chatbox","concat","messages","key","onEdit","targetKey","action","lastIndex","newActiveKey","forEach","_ref4","i","newChatBoxes","filter","chatBox","length","removeChatBox","map","_ref5","friend","chatLog","tab","closable","_ref6","sender","body","textAlign","_ref7","newKey","sort","join","some","_ref3","Error","createChatBox","payload","LOCALSTORAGE_KEY","src_App_0","signIn","savedMe","localStorage","getItem","content","duration","success","setItem","src_reportWebVitals","onPerfEntry","Function","bind","getCLS","getFID","getFCP","getLCP","getTTFB","HttpLink","ApolloClient","inMemoryCache","ApolloProvider","bundle_esm","lib_bundle_esm","apollo_utilities_lib_bundle_esm","httpLink","uri","wsLink","options","reconnect","src_link","query","definition","kind","operation","client","link","cache","restore","a","render","StrictMode","getElementById"],"mappings":"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"},"input":"(this[\"webpackJsonpfrontend\"] = this[\"webpackJsonpfrontend\"] || []).push([[0],{\n\n/***/ 120:\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n\n/***/ 166:\n/***/ (function(module, exports, __webpack_require__) {\n\n// extracted by mini-css-extract-plugin\n\n/***/ }),\n\n/***/ 249:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./node_modules/react/index.js\nvar react = __webpack_require__(0);\nvar react_default = /*#__PURE__*/__webpack_require__.n(react);\n\n// EXTERNAL MODULE: ./node_modules/react-dom/index.js\nvar react_dom = __webpack_require__(28);\nvar react_dom_default = /*#__PURE__*/__webpack_require__.n(react_dom);\n\n// EXTERNAL MODULE: ./node_modules/antd/dist/antd.css\nvar antd = __webpack_require__(165);\n\n// EXTERNAL MODULE: ./src/index.css\nvar src = __webpack_require__(166);\n\n// EXTERNAL MODULE: ./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js + 3 modules\nvar slicedToArray = __webpack_require__(33);\n\n// EXTERNAL MODULE: ./src/App.css\nvar src_App = __webpack_require__(120);\n\n// EXTERNAL MODULE: ./node_modules/antd/es/input/index.js + 12 modules\nvar input = __webpack_require__(266);\n\n// EXTERNAL MODULE: ./node_modules/@ant-design/icons/es/icons/UserOutlined.js + 1 modules\nvar UserOutlined = __webpack_require__(273);\n\n// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js\nvar jsx_runtime = __webpack_require__(14);\n\n// CONCATENATED MODULE: ./src/container/signin.js\nvar signin_SignIn=function SignIn(_ref){var me=_ref.me,setMe=_ref.setMe,setSignIn=_ref.setSignIn,displayStatus=_ref.displayStatus;return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(jsx_runtime[\"Fragment\"],{children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"App-title\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"h1\",{children:\"My Chat Room\"})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(input[\"a\" /* default */].Search,{prefix:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(UserOutlined[\"a\" /* default */],{}),value:me,enterButton:\"Sign In\",onChange:function onChange(e){return setMe(e.target.value);},placeholder:\"Enter your name\",size:\"large\",style:{width:300,margin:50},onSearch:function onSearch(name){if(!name)displayStatus({type:\"error\",msg:\"Missing user name\"});else{displayStatus({type:\"success\",msg:\"success\"});setSignIn(true);}}})]});};/* harmony default export */ var signin = (signin_SignIn);\n// EXTERNAL MODULE: ./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js + 3 modules\nvar toConsumableArray = __webpack_require__(128);\n\n// EXTERNAL MODULE: ./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js + 1 modules\nvar objectSpread2 = __webpack_require__(129);\n\n// EXTERNAL MODULE: ./node_modules/antd/es/form/index.js + 25 modules\nvar es_form = __webpack_require__(262);\n\n// EXTERNAL MODULE: ./node_modules/antd/es/modal/index.js + 7 modules\nvar modal = __webpack_require__(269);\n\n// CONCATENATED MODULE: ./src/component/chatModels.js\nvar chatModels_ChatModal=function ChatModal(_ref){var visible=_ref.visible,onCreate=_ref.onCreate,onCancel=_ref.onCancel;var _Form$useForm=es_form[\"a\" /* default */].useForm(),_Form$useForm2=Object(slicedToArray[\"a\" /* default */])(_Form$useForm,1),form=_Form$useForm2[0];return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(modal[\"a\" /* default */],{visible:visible,title:\"Create a new chat room\",okText:\"Create\",cancelText:\"Cancel\",onCancel:onCancel,onOk:function onOk(){form.validateFields().then(function(values){form.resetFields();onCreate(values);}).catch(function(e){window.alert(e);});},children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(es_form[\"a\" /* default */],{form:form,layout:\"vertical\",name:\"form_in_modal\",children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(es_form[\"a\" /* default */].Item,{name:\"name\",label:\"Name\",rules:[{required:true,message:\"Error: Please enter the name of the person to chat!\"}],children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(input[\"a\" /* default */],{})})})});};/* harmony default export */ var chatModels = (chatModels_ChatModal);\n// EXTERNAL MODULE: ./node_modules/@apollo/client/react/hooks/useMutation.js + 1 modules\nvar useMutation = __webpack_require__(271);\n\n// EXTERNAL MODULE: ./node_modules/@apollo/client/react/hooks/useQuery.js + 3 modules\nvar useQuery = __webpack_require__(270);\n\n// CONCATENATED MODULE: ./src/hooks/useChat.js\nvar useChat_useChat=function useChat(){var _useState=Object(react[\"useState\"])({}),_useState2=Object(slicedToArray[\"a\" /* default */])(_useState,2),status=_useState2[0],setStatus=_useState2[1];// { type, msg }\nvar sendMessage=function sendMessage(payload){console.log(payload);};// { key, msg }\nreturn{status:status,sendMessage:sendMessage};};/* harmony default export */ var hooks_useChat = (useChat_useChat);\n// EXTERNAL MODULE: ./node_modules/antd/es/tabs/index.js + 22 modules\nvar tabs = __webpack_require__(263);\n\n// EXTERNAL MODULE: ./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\nvar taggedTemplateLiteral = __webpack_require__(44);\n\n// EXTERNAL MODULE: ./node_modules/graphql-tag/lib/index.js + 14 modules\nvar lib = __webpack_require__(264);\n\n// CONCATENATED MODULE: ./src/graphql/mutation.js\nvar _templateObject;var CREATE_CHATBOX_MUTATION=Object(lib[\"a\" /* default */])(_templateObject||(_templateObject=Object(taggedTemplateLiteral[\"a\" /* default */])([\"\\nmutation\\n    createChatBox( $name1:String,$name2:String){\\n        createChatBox(name1:$name1,name2:$name2){\\n            _id\\n          name\\n          messages{\\n                body\\n                sender{\\n              name\\n            }\\n            }\\n        }\\n    }\\n\\n    \\n\"])));\n// CONCATENATED MODULE: ./src/graphql/Mutationmess.js\nvar Mutationmess_templateObject;var CREATE_MESSAGE_MUTATION=Object(lib[\"a\" /* default */])(Mutationmess_templateObject||(Mutationmess_templateObject=Object(taggedTemplateLiteral[\"a\" /* default */])([\"\\nmutation\\n    createMessage( $key:String,$body:String,$me:String){\\n        createMessage(key:$key,body:$body,me:$me){\\n            body\\n            sender{\\n              name\\n            }\\n        }\\n    }\\n\\n    \\n\"])));\n// CONCATENATED MODULE: ./src/graphql/query.js\nvar query_templateObject;var CHATBOX_QUERY=Object(lib[\"a\" /* default */])(query_templateObject||(query_templateObject=Object(taggedTemplateLiteral[\"a\" /* default */])([\"\\nquery\\n    chatbox( $name1:String,$name2:String){\\n        chatbox(name1:$name1,name2:$name2){\\n          name\\n          messages{\\n                body\\n                sender{\\n              name\\n            }\\n            }\\n        }\\n    }\\n\\n    \\n\"])));\n// CONCATENATED MODULE: ./src/graphql/messagesubscribe.js\nvar messagesubscribe_templateObject;var MESSAGE_SUBSCRIPTION=Object(lib[\"a\" /* default */])(messagesubscribe_templateObject||(messagesubscribe_templateObject=Object(taggedTemplateLiteral[\"a\" /* default */])([\"\\nsubscription \\n    message ($name1:String,$name2:String) {\\n        message (name1:$name1,name2:$name2){\\n            mutation\\n            data {\\n                body\\n                sender{\\n                  name\\n                }             \\n            }\\n\\n        }\\n     \\n    }\\n\\n\"])));\n// CONCATENATED MODULE: ./src/graphql/allmesssub.js\nvar allmesssub_templateObject;var AllMessage_Sub=Object(lib[\"a\" /* default */])(allmesssub_templateObject||(allmesssub_templateObject=Object(taggedTemplateLiteral[\"a\" /* default */])([\"\\n  subscription {\\n    allmessage {\\n        mutation\\n        data {\\n            body\\n            sender{\\n              name\\n            }             \\n        }\\n    }\\n  }\\n\"])));\n// CONCATENATED MODULE: ./src/graphql/index.js\n\n// CONCATENATED MODULE: ./src/container/chatroom.js\n//import useChatBox from \"../hooks/useChatBox\"\nvar TabPane=tabs[\"a\" /* default */].TabPane;var chatroom_ChatRoom=function ChatRoom(_ref){var me=_ref.me,displayStatus=_ref.displayStatus;// const [chatBoxes, setChatBoxes] = useState([\n//     {\n//         friend: \"Mary\", key: \"MaryChatbox\",\n//         chatLog: []\n//     },\n//     {\n//         friend: \"Peter\", key: \"PeterChatBox\",\n//         chatLog: []\n//     }\n// ]);\nvar _useState=Object(react[\"useState\"])(\"\"),_useState2=Object(slicedToArray[\"a\" /* default */])(_useState,2),name1=_useState2[0],setName1=_useState2[1];var _useState3=Object(react[\"useState\"])(\"\"),_useState4=Object(slicedToArray[\"a\" /* default */])(_useState3,2),name2=_useState4[0],setName2=_useState4[1];var _useState5=Object(react[\"useState\"])(false),_useState6=Object(slicedToArray[\"a\" /* default */])(_useState5,2),ispush=_useState6[0],setIspush=_useState6[1];var _useState7=Object(react[\"useState\"])(\"\"),_useState8=Object(slicedToArray[\"a\" /* default */])(_useState7,2),messageInput=_useState8[0],setMessageInput=_useState8[1];var _useState9=Object(react[\"useState\"])([]),_useState10=Object(slicedToArray[\"a\" /* default */])(_useState9,2),chatBoxes=_useState10[0],setChatBoxes=_useState10[1];var _useState11=Object(react[\"useState\"])(false),_useState12=Object(slicedToArray[\"a\" /* default */])(_useState11,2),modalVisible=_useState12[0],setModalVisible=_useState12[1];var addChatBox=function addChatBox(){setModalVisible(true);};var _useState13=Object(react[\"useState\"])(\"\"),_useState14=Object(slicedToArray[\"a\" /* default */])(_useState13,2),activeKey=_useState14[0],setActiveKey=_useState14[1];console.log(activeKey);var _useMutation=Object(useMutation[\"a\" /* useMutation */])(CREATE_CHATBOX_MUTATION),_useMutation2=Object(slicedToArray[\"a\" /* default */])(_useMutation,1),addChat=_useMutation2[0];var _useMutation3=Object(useMutation[\"a\" /* useMutation */])(CREATE_MESSAGE_MUTATION),_useMutation4=Object(slicedToArray[\"a\" /* default */])(_useMutation3,1),addMessage=_useMutation4[0];var myname;var first;var second;Object(react[\"useEffect\"])(function(){console.log(\"active\");console.log(activeKey);if(activeKey){console.log(activeKey);myname=activeKey.split(\"_\");console.log(myname);if(myname[0]===me){first=myname[0];second=myname[1];}else{first=myname[1];second=myname[0];}setName1(first);setName2(second);}},[activeKey]);console.log(name2);var _useQuery=Object(useQuery[\"a\" /* useQuery */])(CHATBOX_QUERY,{variables:{name1:name1,name2:name2// name1: \"jimmy\",\n// name2: \"peter\",\n}}),loading=_useQuery.loading,error=_useQuery.error,data=_useQuery.data,subscribeToMore=_useQuery.subscribeToMore;console.log(data);if(typeof data===\"undefined\"){console.log(\"111\");}// if(data.chatbox===null){\n//     console.log(\"null\")\n// }\nObject(react[\"useEffect\"])(function(){console.log('11');subscribeToMore({document:AllMessage_Sub,// variables: {\n//     name1: name1,\n//     name2: name2,\n// },\nupdateQuery:function updateQuery(prev,_ref2){var subscriptionData=_ref2.subscriptionData;console.log('11');// console.log(prev.chatbox.messages)\n// console.log(subscriptionData)\n// let newchat = chatBoxes\n// if (!subscriptionData.data.allmessage) {\n//     console.log(\"12445789\")\n//     console.log(prev);\n//     newchat.push({ friend: name2, key: activeKey, chatLog: prev.chatbox.messages });\n//     console.log(newchat);\n//     setChatBoxes(newchat);\n//     return prev;\n// }\nvar newMess=subscriptionData.data.allmessage.data;// console.log(newMess);\n// newchat.push({ friend: name2, key: activeKey, chatLog: prev.chatbox.messages });\n// console.log(newchat);\n// setChatBoxes(newchat);\n// newchat = {friend : name2,key : activeKey ,chatLog : data};\nreturn Object(objectSpread2[\"a\" /* default */])(Object(objectSpread2[\"a\" /* default */])({},prev),{},{// posts: [newPost, ...prev.posts]\nchatbox:[].concat(Object(toConsumableArray[\"a\" /* default */])(prev.chatbox.messages),[newMess])});}});// let newchat = {friend : name2,key : activeKey ,chatLog : data};\n// console.log(newchat)\n// console.log(\"123\")\n},[subscribeToMore]);var newbox=[];console.log(\"render\");console.log(chatBoxes);// useEffect(()=>{\n//     console.log(\"888\")\n//     console.log(data)\n//     if(typeof data !== \"undefined\" && data.chatbox !== null){\n//         console.log(\"888\")\n//         console.log(data)\n//         newbox = chatBoxes\n//         console.log(data.chatbox.messages)\n//         newbox.push({friend:name2,key:data.chatbox.name,chatLog:data.chatbox.messages});\n//         console.log(newbox)\n//     }\n// },[ispush])\n// const { loading, error, data  } = useSubscription(\n//     MESSAGE_SUBSCRIPTION,\n//     { variables: {\n//         name1: name1,\n//         name2: name2,\n//         } \n//     }\n//     );\n// console.log(data)\n//console.log(data2)\n// if(data.chatbox){\n//     let filter =data.chatbox.messages.map(e=>e.body)\n//     console.log(filter)\n// } \n//data will be unndeefined\n// const pushdata = (friend,me) => {\n//     chatBoxes.push({friend:friend,key:activeKey,chatLog:data.chatBox.messages});\n//     console.log(chatBoxes)\n// }\n//data will be unndeefined\n//msg.push(inputmsg[0]);\n// useEffect(() => {\n//     console.log('execute function in useEffect');\n//   },[inputmsg]);\nvar sendMessage=function sendMessage(payload){console.log(payload);// key:11_1 body:'messenge'\naddMessage({variables:{key:payload.key,body:payload.body,me:payload.sender}});// SendData({\n//     type: 'Message',\n//     data: { key: payload.key, body: payload.body, me: payload.sender },\n// })\n};//CHAT MODELS CALL\nvar createChatBox=function createChatBox(friend,me){//比對字串大小\n// const { loading, error, data,refetch,subscribeToMore } = useQuery(CHATBOX_QUERY,{\n//     variables: {\n//         name1: me,\n//         name2: friend,\n//     },\n// });\naddChat({variables:{name1:me,name2:friend}});setName1(me);setName2(friend);// pushdata(friend,me)\n// const newKey = me <= friend ?\n//     `${me}_${friend}` : `${friend}_${me}`;\nvar newKey=[me,friend].sort().join('_');console.log(newKey);if(chatBoxes.some(function(_ref3){var key=_ref3.key;return key===newKey;})){throw new Error(friend+\"'s chat box has already opened.\");}var newChatBoxes=Object(toConsumableArray[\"a\" /* default */])(chatBoxes);var chatLog=[];newChatBoxes.push({friend:friend,key:newKey,chatLog:chatLog});setChatBoxes(newChatBoxes);setActiveKey(newKey);setIspush(true);};var removeChatBox=function removeChatBox(targetKey,activeKey){var newActiveKey=activeKey;//index before\nvar lastIndex;chatBoxes.forEach(function(_ref4,i){var key=_ref4.key;if(key===targetKey){lastIndex=i-1;}});var newChatBoxes=chatBoxes.filter(function(chatBox){return chatBox.key!==targetKey;});if(newChatBoxes.length){if(newActiveKey===targetKey){if(lastIndex>=0){newActiveKey=newChatBoxes[lastIndex].key;}else{newActiveKey=newChatBoxes[0].key;}}}else newActiveKey=\"\";//No chatBox left\nsetChatBoxes(newChatBoxes);setActiveKey(newActiveKey);};return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(jsx_runtime[\"Fragment\"],{children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"App-title\",children:/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"h1\",{children:[me,\"'s Chat Room\"]})}),/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"div\",{className:\"App-messages\",children:[/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(tabs[\"a\" /* default */],{type:\"editable-card\",activeKey:activeKey,onChange:function onChange(key){setActiveKey(key);alert(key);}//按+號時\n,onEdit:function onEdit(targetKey,action){if(action===\"add\")addChatBox();else if(action===\"remove\")removeChatBox(targetKey,activeKey,setActiveKey);},children:chatBoxes.map(function(_ref5){var friend=_ref5.friend,key=_ref5.key,chatLog=_ref5.chatLog;return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(TabPane,{tab:friend,closable:true,children:typeof data===\"undefined\"||data.chatbox===null?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"Loading...\"}):data.chatbox.messages.length===0?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"p\",{children:\"NO MESSAGE..\"}):data.chatbox.messages.map(function(_ref6,i){var sender=_ref6.sender,body=_ref6.body;if(sender[0].name!==me){return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"p\",{children:[sender[0].name,\":\",body]});}else{return/*#__PURE__*/Object(jsx_runtime[\"jsxs\"])(\"p\",{style:{textAlign:\"right\"},children:[body,\":\",sender[0].name]});}})},key);})}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(chatModels,{visible:modalVisible,onCreate:function onCreate(_ref7){var name=_ref7.name;createChatBox(name,me,setActiveKey);setModalVisible(false);},onCancel:function onCancel(){setModalVisible(false);}})]}),/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(input[\"a\" /* default */].Search,{value:messageInput,onChange:function onChange(e){return setMessageInput(e.target.value);},enterButton:\"Send\",placeholder:\"Enter message here...\",onSearch:function onSearch(msg){if(!msg){displayStatus({type:\"error\",msg:\"Please enter message.\"});return;}else if(activeKey===\"\"){displayStatus({type:\"error\",msg:\"Please add a chatbox first.\"});setMessageInput(\"\");return;}sendMessage({key:activeKey,body:msg,sender:me});setMessageInput(\"\");}})]});};/* harmony default export */ var chatroom = (chatroom_ChatRoom);\n// EXTERNAL MODULE: ./node_modules/antd/es/message/index.js + 3 modules\nvar message = __webpack_require__(153);\n\n// CONCATENATED MODULE: ./src/App.js\nvar LOCALSTORAGE_KEY=\"save-me\";var App_App=function App(){var _useState=Object(react[\"useState\"])(false),_useState2=Object(slicedToArray[\"a\" /* default */])(_useState,2),signIn=_useState2[0],setSignIn=_useState2[1];var savedMe=localStorage.getItem(LOCALSTORAGE_KEY);var _useState3=Object(react[\"useState\"])(savedMe||\"\"),_useState4=Object(slicedToArray[\"a\" /* default */])(_useState3,2),me=_useState4[0],setMe=_useState4[1];var displayStatus=function displayStatus(payload){if(payload.msg){var type=payload.type,msg=payload.msg;//console.log(payload)\nvar content={content:msg,duration:1};switch(type){case'success':message[\"b\" /* default */].success(content);break;case'error':default:message[\"b\" /* default */].error(content);break;}}};Object(react[\"useEffect\"])(function(){if(signIn){localStorage.setItem(LOCALSTORAGE_KEY,me);}},[signIn]);return/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(\"div\",{className:\"App\",children:signIn?/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(chatroom,{me:me,displayStatus:displayStatus}):/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(signin,{setMe:setMe,me:me,setSignIn:setSignIn,displayStatus:displayStatus})});};/* harmony default export */ var src_App_0 = (App_App);\n// CONCATENATED MODULE: ./src/reportWebVitals.js\nvar reportWebVitals=function reportWebVitals(onPerfEntry){if(onPerfEntry&&onPerfEntry instanceof Function){__webpack_require__.e(/* import() */ 3).then(__webpack_require__.bind(null, 274)).then(function(_ref){var getCLS=_ref.getCLS,getFID=_ref.getFID,getFCP=_ref.getFCP,getLCP=_ref.getLCP,getTTFB=_ref.getTTFB;getCLS(onPerfEntry);getFID(onPerfEntry);getFCP(onPerfEntry);getLCP(onPerfEntry);getTTFB(onPerfEntry);});}};/* harmony default export */ var src_reportWebVitals = (reportWebVitals);\n// EXTERNAL MODULE: ./node_modules/@apollo/client/link/http/HttpLink.js + 10 modules\nvar HttpLink = __webpack_require__(267);\n\n// EXTERNAL MODULE: ./node_modules/@apollo/client/core/ApolloClient.js + 14 modules\nvar ApolloClient = __webpack_require__(265);\n\n// EXTERNAL MODULE: ./node_modules/@apollo/client/cache/inmemory/inMemoryCache.js + 8 modules\nvar inMemoryCache = __webpack_require__(268);\n\n// EXTERNAL MODULE: ./node_modules/@apollo/client/react/context/ApolloProvider.js\nvar ApolloProvider = __webpack_require__(261);\n\n// EXTERNAL MODULE: ./node_modules/apollo-link/lib/bundle.esm.js + 1 modules\nvar bundle_esm = __webpack_require__(110);\n\n// EXTERNAL MODULE: ./node_modules/apollo-link-ws/lib/bundle.esm.js\nvar lib_bundle_esm = __webpack_require__(150);\n\n// EXTERNAL MODULE: ./node_modules/apollo-utilities/lib/bundle.esm.js\nvar apollo_utilities_lib_bundle_esm = __webpack_require__(65);\n\n// CONCATENATED MODULE: ./src/index.js\n// Create an http link:\nvar httpLink=new HttpLink[\"a\" /* HttpLink */]({uri:\"http://localhost:5000/\"});// Create a WebSocket link:\nvar wsLink=new lib_bundle_esm[\"a\" /* WebSocketLink */]({uri:\"ws://localhost:5000/\",options:{reconnect:true}});// using the ability to split links, you can send data to each link\n// depending on what kind of operation is being sent\nvar src_link=Object(bundle_esm[\"b\" /* split */])(// split based on operation type\nfunction(_ref){var query=_ref.query;var definition=Object(apollo_utilities_lib_bundle_esm[\"a\" /* getMainDefinition */])(query);return definition.kind==='OperationDefinition'&&definition.operation==='subscription';},wsLink,httpLink);var client=new ApolloClient[\"a\" /* ApolloClient */]({link:src_link,cache:new inMemoryCache[\"a\" /* InMemoryCache */]().restore({})});react_dom_default.a.render(/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(react_default.a.StrictMode,{children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(ApolloProvider[\"a\" /* ApolloProvider */],{client:client,children:/*#__PURE__*/Object(jsx_runtime[\"jsx\"])(src_App_0,{})})}),document.getElementById('root'));// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nsrc_reportWebVitals();\n\n/***/ })\n\n},[[249,1,2]]]);","inputSourceMap":{"version":3,"sources":["D:\\碩一下\\網路服務\\Chatroom GraphQL\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\碩一下\\網路服務\\Chatroom GraphQL\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\碩一下\\網路服務\\Chatroom GraphQL\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\碩一下\\網路服務\\Chatroom GraphQL\\src\\App.css","D:\\碩一下\\網路服務\\Chatroom GraphQL\\node_modules\\mini-css-extract-plugin\\dist\\loader.js??ref--5-oneOf-4-0!D:\\碩一下\\網路服務\\Chatroom GraphQL\\node_modules\\css-loader\\dist\\cjs.js??ref--5-oneOf-4-1!D:\\碩一下\\網路服務\\Chatroom GraphQL\\node_modules\\postcss-loader\\src\\index.js??postcss!D:\\碩一下\\網路服務\\Chatroom GraphQL\\src\\index.css","D:/碩一下/網路服務/Chatroom GraphQL/src/container/signin.js","D:/碩一下/網路服務/Chatroom GraphQL/src/component/chatModels.js","D:/碩一下/網路服務/Chatroom GraphQL/src/hooks/useChat.js","D:/碩一下/網路服務/Chatroom GraphQL/src/graphql/mutation.js","D:/碩一下/網路服務/Chatroom GraphQL/src/graphql/Mutationmess.js","D:/碩一下/網路服務/Chatroom GraphQL/src/graphql/query.js","D:/碩一下/網路服務/Chatroom GraphQL/src/graphql/messagesubscribe.js","D:/碩一下/網路服務/Chatroom GraphQL/src/graphql/allmesssub.js","D:/碩一下/網路服務/Chatroom GraphQL/src/container/chatroom.js","D:/碩一下/網路服務/Chatroom GraphQL/src/App.js","D:/碩一下/網路服務/Chatroom GraphQL/src/reportWebVitals.js","D:/碩一下/網路服務/Chatroom GraphQL/src/index.js"],"names":["SignIn","me","setMe","setSignIn","displayStatus","e","target","value","width","margin","name","type","msg","ChatModal","visible","onCreate","onCancel","Form","useForm","form","validateFields","then","values","resetFields","catch","window","alert","required","message","useChat","useState","status","setStatus","sendMessage","payload","console","log","CREATE_CHATBOX_MUTATION","gql","CREATE_MESSAGE_MUTATION","CHATBOX_QUERY","MESSAGE_SUBSCRIPTION","AllMessage_Sub","TabPane","Tabs","ChatRoom","name1","setName1","name2","setName2","ispush","setIspush","messageInput","setMessageInput","chatBoxes","setChatBoxes","modalVisible","setModalVisible","addChatBox","activeKey","setActiveKey","useMutation","addChat","addMessage","myname","first","second","useEffect","split","useQuery","variables","loading","error","data","subscribeToMore","document","updateQuery","prev","subscriptionData","newMess","allmessage","chatbox","messages","newbox","key","body","sender","createChatBox","friend","newKey","sort","join","some","Error","newChatBoxes","chatLog","push","removeChatBox","targetKey","newActiveKey","lastIndex","forEach","i","filter","chatBox","length","action","map","textAlign","LOCALSTORAGE_KEY","App","signIn","savedMe","localStorage","getItem","content","duration","success","setItem","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","httpLink","HttpLink","uri","wsLink","WebSocketLink","options","reconnect","link","query","definition","getMainDefinition","kind","operation","client","ApolloClient","cache","InMemoryCache","restore","ReactDOM","render","getElementById"],"mappings":"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","file":"x","sourcesContent":["// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","import \"../App.css\";\r\nimport { Input } from \"antd\";\r\nimport { UserOutlined } from \"@ant-design/icons\";\r\nconst SignIn = ({ me, setMe, setSignIn ,displayStatus}) => (\r\n    <>\r\n        <div className=\"App-title\">\r\n            <h1>My Chat Room</h1>\r\n        </div>\r\n        <Input.Search\r\n            prefix={<UserOutlined />}\r\n            value={me}\r\n            enterButton=\"Sign In\"\r\n            onChange={(e) => setMe(e.target.value)}\r\n            placeholder=\"Enter your name\"\r\n            size=\"large\"\r\n            style={{ width: 300, margin: 50 }}\r\n            onSearch={(name) => {\r\n                if (!name) displayStatus({\r\n                    type: \"error\",\r\n                    msg: \"Missing user name\",\r\n                });\r\n                else {\r\n                    displayStatus({\r\n                        type: \"success\",\r\n                        msg: \"success\",\r\n                    });\r\n                    setSignIn(true);\r\n                }\r\n\r\n            }}\r\n        >\r\n        </Input.Search>\r\n    </>\r\n)\r\nexport default SignIn;","import { Modal, Form, Input } from \"antd\";\r\n\r\nconst ChatModal = ({ visible, onCreate,onCancel }) => {\r\n    const [form] = Form.useForm();\r\n    return (\r\n        <Modal\r\n            visible={visible}\r\n            title=\"Create a new chat room\"\r\n            okText=\"Create\" cancelText=\"Cancel\"\r\n            onCancel={onCancel}\r\n            onOk={() => {\r\n                form.validateFields().then((values) => {\r\n                    form.resetFields();\r\n                    onCreate(values);\r\n                }).catch((e) => { window.alert(e); });\r\n            }}>\r\n            <Form form={form} layout=\"vertical\"\r\n                name=\"form_in_modal\">\r\n                <Form.Item\r\n                    name=\"name\" label=\"Name\"\r\n                    rules={[{\r\n                        required: true,\r\n                        message: \"Error: Please enter the name of the person to chat!\",\r\n                    },]}\r\n                >\r\n                    <Input />\r\n                </Form.Item>\r\n            </Form>\r\n        </Modal>\r\n    );\r\n};\r\nexport default ChatModal\r\n\r\n","import { useState } from \"react\";\r\nconst useChat = () => {\r\n    const [status, setStatus] = useState({}); // { type, msg }\r\n    const sendMessage = (payload) => {\r\n        console.log(payload);\r\n    }; // { key, msg }\r\n    return { status, sendMessage };\r\n};\r\nexport default useChat;\r\n","import { gql } from '@apollo/client';\r\n\r\nexport const CREATE_CHATBOX_MUTATION = gql`\r\nmutation\r\n    createChatBox( $name1:String,$name2:String){\r\n        createChatBox(name1:$name1,name2:$name2){\r\n            _id\r\n          name\r\n          messages{\r\n                body\r\n                sender{\r\n              name\r\n            }\r\n            }\r\n        }\r\n    }\r\n\r\n    \r\n`;","import { gql } from '@apollo/client';\r\n\r\nexport const CREATE_MESSAGE_MUTATION = gql`\r\nmutation\r\n    createMessage( $key:String,$body:String,$me:String){\r\n        createMessage(key:$key,body:$body,me:$me){\r\n            body\r\n            sender{\r\n              name\r\n            }\r\n        }\r\n    }\r\n\r\n    \r\n`;","import { gql } from '@apollo/client';\r\n\r\nexport const CHATBOX_QUERY = gql`\r\nquery\r\n    chatbox( $name1:String,$name2:String){\r\n        chatbox(name1:$name1,name2:$name2){\r\n          name\r\n          messages{\r\n                body\r\n                sender{\r\n              name\r\n            }\r\n            }\r\n        }\r\n    }\r\n\r\n    \r\n`;","import { gql } from '@apollo/client';\r\n\r\nexport const MESSAGE_SUBSCRIPTION = gql`\r\nsubscription \r\n    message ($name1:String,$name2:String) {\r\n        message (name1:$name1,name2:$name2){\r\n            mutation\r\n            data {\r\n                body\r\n                sender{\r\n                  name\r\n                }             \r\n            }\r\n\r\n        }\r\n     \r\n    }\r\n\r\n`;\r\n","import { gql } from '@apollo/client';\r\n\r\nexport const AllMessage_Sub = gql`\r\n  subscription {\r\n    allmessage {\r\n        mutation\r\n        data {\r\n            body\r\n            sender{\r\n              name\r\n            }             \r\n        }\r\n    }\r\n  }\r\n`;\r\n","import \"../App.css\";\r\nimport ChatModal from \"../component/chatModels\"\r\n//import useChatBox from \"../hooks/useChatBox\"\r\nimport { useQuery, useMutation, useSubscription } from '@apollo/react-hooks';\r\nimport useChat from \"../hooks/useChat\"\r\nimport { useState, useEffect } from \"react\";\r\nimport { Tabs, Input } from \"antd\";\r\nimport {\r\n    CREATE_CHATBOX_MUTATION,\r\n    CREATE_MESSAGE_MUTATION,\r\n    CHATBOX_QUERY,\r\n    MESSAGE_SUBSCRIPTION,\r\n    AllMessage_Sub,\r\n} from '../graphql';\r\nimport { isTypeNode } from \"graphql\";\r\nconst { TabPane } = Tabs;\r\nconst ChatRoom = ({ me, displayStatus }) => {\r\n    // const [chatBoxes, setChatBoxes] = useState([\r\n    //     {\r\n    //         friend: \"Mary\", key: \"MaryChatbox\",\r\n    //         chatLog: []\r\n    //     },\r\n    //     {\r\n    //         friend: \"Peter\", key: \"PeterChatBox\",\r\n    //         chatLog: []\r\n    //     }\r\n    // ]);\r\n    const [name1, setName1] = useState(\"\");\r\n    const [name2, setName2] = useState(\"\");\r\n    const [ispush, setIspush] = useState(false);\r\n    const [messageInput, setMessageInput] = useState(\"\");\r\n    const [chatBoxes, setChatBoxes] = useState([]);\r\n    const [modalVisible, setModalVisible] = useState(false);\r\n    const addChatBox = () => { setModalVisible(true); };\r\n    const [activeKey, setActiveKey] = useState(\"\")\r\n    console.log(activeKey)\r\n    const [addChat] = useMutation(CREATE_CHATBOX_MUTATION);\r\n    const [addMessage] = useMutation(CREATE_MESSAGE_MUTATION);\r\n    let myname\r\n    let first\r\n    let second\r\n    useEffect(() => {\r\n        console.log(\"active\")\r\n        console.log(activeKey)\r\n        if (activeKey) {\r\n            console.log(activeKey)\r\n            myname = activeKey.split(\"_\")\r\n            console.log(myname)\r\n            if (myname[0] === me) {\r\n                first = myname[0]\r\n                second = myname[1]\r\n            }\r\n            else {\r\n                first = myname[1]\r\n                second = myname[0]\r\n            }\r\n            setName1(first)\r\n            setName2(second)\r\n        }\r\n\r\n    }, [activeKey])\r\n    console.log(name2)\r\n\r\n    const { loading, error, data, subscribeToMore } = useQuery(CHATBOX_QUERY, {\r\n        variables: {\r\n            name1: name1,\r\n            name2: name2,\r\n            // name1: \"jimmy\",\r\n            // name2: \"peter\",\r\n        },\r\n    })\r\n    console.log(data)\r\n    if (typeof (data) === \"undefined\") {\r\n        console.log(\"111\")\r\n    }\r\n    // if(data.chatbox===null){\r\n    //     console.log(\"null\")\r\n    // }\r\n    useEffect(() => {\r\n        console.log('11')\r\n        subscribeToMore({\r\n            document: AllMessage_Sub,\r\n            // variables: {\r\n            //     name1: name1,\r\n            //     name2: name2,\r\n            // },\r\n            updateQuery: (prev, { subscriptionData }) => {\r\n                console.log('11')\r\n                // console.log(prev.chatbox.messages)\r\n                // console.log(subscriptionData)\r\n                // let newchat = chatBoxes\r\n                // if (!subscriptionData.data.allmessage) {\r\n                //     console.log(\"12445789\")\r\n                //     console.log(prev);\r\n                //     newchat.push({ friend: name2, key: activeKey, chatLog: prev.chatbox.messages });\r\n                //     console.log(newchat);\r\n                //     setChatBoxes(newchat);\r\n                //     return prev;\r\n                // }\r\n                const newMess = subscriptionData.data.allmessage.data\r\n                // console.log(newMess);\r\n                // newchat.push({ friend: name2, key: activeKey, chatLog: prev.chatbox.messages });\r\n                // console.log(newchat);\r\n                // setChatBoxes(newchat);\r\n                // newchat = {friend : name2,key : activeKey ,chatLog : data};\r\n                return {\r\n                    ...prev,\r\n                    // posts: [newPost, ...prev.posts]\r\n                    chatbox: [...prev.chatbox.messages, newMess]\r\n                }\r\n            }\r\n        })\r\n\r\n        // let newchat = {friend : name2,key : activeKey ,chatLog : data};\r\n        // console.log(newchat)\r\n        // console.log(\"123\")\r\n    }, [subscribeToMore])\r\n\r\n\r\n    let newbox = []\r\n\r\n    console.log(\"render\")\r\n    console.log(chatBoxes)\r\n    // useEffect(()=>{\r\n    //     console.log(\"888\")\r\n    //     console.log(data)\r\n    //     if(typeof data !== \"undefined\" && data.chatbox !== null){\r\n    //         console.log(\"888\")\r\n    //         console.log(data)\r\n    //         newbox = chatBoxes\r\n    //         console.log(data.chatbox.messages)\r\n    //         newbox.push({friend:name2,key:data.chatbox.name,chatLog:data.chatbox.messages});\r\n    //         console.log(newbox)\r\n    //     }\r\n    // },[ispush])\r\n\r\n\r\n\r\n    // const { loading, error, data  } = useSubscription(\r\n    //     MESSAGE_SUBSCRIPTION,\r\n    //     { variables: {\r\n    //         name1: name1,\r\n    //         name2: name2,\r\n    //         } \r\n    //     }\r\n    //     );\r\n    // console.log(data)\r\n    //console.log(data2)\r\n\r\n\r\n\r\n    // if(data.chatbox){\r\n    //     let filter =data.chatbox.messages.map(e=>e.body)\r\n    //     console.log(filter)\r\n    // } \r\n\r\n    //data will be unndeefined\r\n    // const pushdata = (friend,me) => {\r\n    //     chatBoxes.push({friend:friend,key:activeKey,chatLog:data.chatBox.messages});\r\n    //     console.log(chatBoxes)\r\n    // }\r\n    //data will be unndeefined\r\n\r\n    //msg.push(inputmsg[0]);\r\n    // useEffect(() => {\r\n    //     console.log('execute function in useEffect');\r\n    //   },[inputmsg]);\r\n\r\n    const sendMessage = (payload) => {\r\n        console.log(payload);// key:11_1 body:'messenge'\r\n        addMessage({\r\n            variables: {\r\n                key: payload.key,\r\n                body: payload.body,\r\n                me: payload.sender,\r\n            },\r\n        });\r\n\r\n        // SendData({\r\n        //     type: 'Message',\r\n        //     data: { key: payload.key, body: payload.body, me: payload.sender },\r\n        // })\r\n    };\r\n    //CHAT MODELS CALL\r\n    const createChatBox = (friend, me) => {\r\n        //比對字串大小\r\n        // const { loading, error, data,refetch,subscribeToMore } = useQuery(CHATBOX_QUERY,{\r\n        //     variables: {\r\n        //         name1: me,\r\n        //         name2: friend,\r\n        //     },\r\n        // });\r\n        addChat({\r\n            variables: {\r\n                name1: me,\r\n                name2: friend,\r\n            },\r\n        });\r\n        setName1(me);\r\n        setName2(friend);\r\n\r\n\r\n\r\n        // pushdata(friend,me)\r\n        // const newKey = me <= friend ?\r\n        //     `${me}_${friend}` : `${friend}_${me}`;\r\n        const newKey = [me, friend].sort().join('_');\r\n        console.log(newKey)\r\n        if (chatBoxes.some(({ key }) => key === newKey)) {\r\n            throw new Error(friend +\r\n                \"'s chat box has already opened.\");\r\n        }\r\n        const newChatBoxes = [...chatBoxes];\r\n        const chatLog = [];\r\n        newChatBoxes.push({ friend, key: newKey, chatLog });\r\n        setChatBoxes(newChatBoxes);\r\n        setActiveKey(newKey);\r\n        setIspush(true);\r\n    };\r\n    const removeChatBox = (targetKey, activeKey) => {\r\n        let newActiveKey = activeKey;\r\n        //index before\r\n        let lastIndex;\r\n        chatBoxes.forEach(({ key }, i) => {\r\n            if (key === targetKey) { lastIndex = i - 1; }\r\n        });\r\n        const newChatBoxes = chatBoxes.filter(\r\n            (chatBox) => chatBox.key !== targetKey);\r\n        if (newChatBoxes.length) {\r\n            if (newActiveKey === targetKey) {\r\n                if (lastIndex >= 0) {\r\n                    newActiveKey = newChatBoxes[lastIndex].key;\r\n                } else { newActiveKey = newChatBoxes[0].key; }\r\n            }\r\n        } else newActiveKey = \"\";\r\n        //No chatBox left\r\n        setChatBoxes(newChatBoxes);\r\n        setActiveKey(newActiveKey);\r\n\r\n    };\r\n\r\n\r\n\r\n    return (\r\n        <>\r\n            <div className=\"App-title\">\r\n                <h1>{me}'s Chat Room</h1>\r\n            </div>\r\n            <div className=\"App-messages\">\r\n                <Tabs type=\"editable-card\"\r\n                    activeKey={activeKey}\r\n                    onChange={(key) => { setActiveKey(key);  alert(key)}}\r\n\r\n                    //按+號時\r\n                    onEdit={(targetKey, action) => {\r\n                        if (action === \"add\") addChatBox();\r\n                        else if (action === \"remove\") removeChatBox(targetKey, activeKey, setActiveKey)\r\n                    }}\r\n                >\r\n                    {chatBoxes.map(({ friend, key, chatLog }) => {\r\n                        return (\r\n                            <TabPane tab={friend}\r\n                                key={key} closable={true}>\r\n                                {(typeof (data) === \"undefined\" || data.chatbox === null) ? (<p>Loading...</p>) :\r\n                                    (data.chatbox.messages.length === 0 ? (<p>NO MESSAGE..</p>) : (\r\n                                        data.chatbox.messages.map(({ sender, body }, i) => {\r\n                                            if (sender[0].name !== me) {\r\n                                                return (\r\n                                                    <p >{sender[0].name}:{body}</p>\r\n                                                )\r\n                                            }\r\n                                            else {\r\n                                                return (\r\n                                                    <p style={{ textAlign: \"right\" }}>{body}:{sender[0].name}</p>\r\n                                                )\r\n                                            }\r\n                                        })\r\n                                    ))}\r\n                            </TabPane>\r\n                        );\r\n                    }\r\n                    )}\r\n                    {/* {(typeof(data) ===\"undefined\" || data.chatbox===null)?(<p>Loading ...</p>):\r\n            (data.chatbox.messages.length===0 ?\r\n                (<p style={{ color: '#ccc' }}>No messages...</p>):\r\n                (data.chatbox.messages.map(({sender,body},i)=>{\r\n                    if(sender.name!==me){\r\n                        return (\r\n                            <div className=\"bubbleWrapper\" key={i}>\r\n                                <div className=\"inlineContainer\">\r\n                                    <p>{sender.name}:{body}</p>\r\n                                </div>\r\n                            </div>)\r\n                    }\r\n                    else{\r\n                        return (\r\n                            <div className=\"bubbleWrapper\" key={i}>\r\n                                <div className=\"inlineContainer own\">\r\n                                     <p>{sender.name}:{body}</p>\r\n                                </div>\r\n                            </div>)\r\n                    }\r\n                })\r\n                )\r\n            )} */}\r\n                    {/* {\r\n                            msg.map(({ body, name })=>{\r\n                                return (\r\n                                    <TabPane tab={name }\r\n                                         closable={true}>\r\n                                        <p>{name}:{body}</p>\r\n                                    </TabPane>\r\n                                );\r\n                            })\r\n                    } */}\r\n                </Tabs>\r\n                <ChatModal\r\n                    visible={modalVisible}\r\n                    onCreate={({ name }) => {\r\n                        createChatBox(name, me, setActiveKey);\r\n                        setModalVisible(false);\r\n                    }}\r\n                    onCancel={() => {\r\n                        setModalVisible(false);\r\n                    }}\r\n                />\r\n\r\n            </div>\r\n            <Input.Search\r\n                value={messageInput}\r\n                onChange={(e) =>\r\n                    setMessageInput(e.target.value)}\r\n                enterButton=\"Send\"\r\n                placeholder=\r\n                \"Enter message here...\"\r\n                onSearch={(msg) => {\r\n                    if (!msg) {\r\n                        displayStatus({\r\n                            type: \"error\",\r\n                            msg: \"Please enter message.\",\r\n                        });\r\n                        return;\r\n                    } else if (activeKey === \"\") {\r\n                        displayStatus({\r\n                            type: \"error\",\r\n                            msg: \"Please add a chatbox first.\",\r\n                        });\r\n                        setMessageInput(\"\");\r\n                        return;\r\n                    }\r\n                    sendMessage({ key: activeKey, body: msg, sender: me });\r\n                    setMessageInput(\"\");\r\n                }}\r\n            >\r\n            </Input.Search>\r\n        </>\r\n    )\r\n\r\n}\r\nexport default ChatRoom;","import './App.css';\nimport SignIn from './container/signin';\nimport ChatRoom from './container/chatroom'\nimport { useState, useEffect } from \"react\";\nimport { message } from \"antd\"\nconst LOCALSTORAGE_KEY = \"save-me\";\nconst App = () => {\n\tconst [signIn, setSignIn] = useState(false);\n\tconst savedMe = localStorage.getItem(LOCALSTORAGE_KEY);\n\tconst [me, setMe] = useState(savedMe || \"\");\n\tconst displayStatus = (payload) => {\n\t\tif (payload.msg) {\n\t\t\tconst { type, msg } = payload\n\t\t\t//console.log(payload)\n\t\t\tconst content = {\n\t\t\t\tcontent: msg, duration: 1\n\t\t\t}\n\t\t\tswitch (type) {\n\t\t\t\tcase 'success':\n\t\t\t\t\tmessage.success(content)\n\t\t\t\t\tbreak\n\t\t\t\tcase 'error':\n\t\t\t\tdefault:\n\t\t\t\t\tmessage.error(content)\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\tuseEffect(() => {\n\t\tif (signIn) {\n\t\t\tlocalStorage.setItem(LOCALSTORAGE_KEY, me);\n\t\t}\n\t},[signIn])\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t{signIn ? (<ChatRoom me={me} displayStatus = {displayStatus}/>) : (<SignIn setMe={setMe} me={me} setSignIn={setSignIn} displayStatus={displayStatus} />)}\n\t\t</div>\n\t);\n\n};\nexport default App;","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'antd/dist/antd.css';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport {\n  ApolloClient,\n  InMemoryCache,\n  ApolloProvider,\n  HttpLink,\n} from \"@apollo/client\";\nimport { split } from \"apollo-link\";\nimport { WebSocketLink } from \"apollo-link-ws\";\nimport { getMainDefinition } from \"apollo-utilities\";\n// Create an http link:\nconst httpLink = new HttpLink({\n  uri: \"http://localhost:5000/\",\n});\n// Create a WebSocket link:\nconst wsLink = new WebSocketLink({\n  uri: `ws://localhost:5000/`,\n  options: { reconnect: true },\n});\n// using the ability to split links, you can send data to each link\n// depending on what kind of operation is being sent\nconst link = split(\n  // split based on operation type\n  ({ query }) => {\n    const definition = getMainDefinition(query);\n    return (\n      definition.kind === 'OperationDefinition' &&\n      definition.operation === 'subscription'\n    );\n  },\n  wsLink,\n  httpLink,\n);\nconst client = new ApolloClient({\n  link,\n  cache: new InMemoryCache().restore({}),\n});\n\nReactDOM.render(\n  <React.StrictMode>\n    <ApolloProvider client={client}>\n    <App />\n    </ApolloProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"]}}